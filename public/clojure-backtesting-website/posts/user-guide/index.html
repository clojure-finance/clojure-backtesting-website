<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"><![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"><![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"><![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"><!--<![endif]-->
<head>
    <!-- Website Template designed by www.downloadwebsitetemplates.co.uk -->
    <!-- Modified to fit Cryogen.-->
    <meta charset="UTF-8">
    <title>Clojure Backtesting Documentation: User Guide</title>
    
<meta name="keywords" content="">

<meta name="description" content="About the datasetCRSP is the official dataset for the backtester. New users are recommended to directly use this dataset to try out the functionalities of the backtester. Definitions for each column in CRSP can be found here.">

<meta property="og:description" content="About the datasetCRSP is the official dataset for the backtester. New users are recommended to directly use this dataset to try out the functionalities of the backtester. Definitions for each column in CRSP can be found here.">

<meta property="og:url" content="https://clojure-finance.github.io/clojure-backtesting-website/clojure-backtesting-website/posts/user-guide/" />
<meta property="og:title" content="User Guide" />
<meta property="og:type" content="article" />

    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/ico/apple-touch-icon-144.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/ico/apple-touch-icon-114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/ico/apple-touch-icon-72.png">
    <link rel="apple-touch-icon-precomposed" href="images/ico/apple-touch-icon-57.png">
    <link rel="shortcut icon" href="images/ico/favicon.png">
    <!--[if IE]><![endif]-->
    <link href="/clojure-backtesting-website/css/buttons.css" rel="stylesheet" type="text/css" />
    <link href="/clojure-backtesting-website/css/menu.css" rel="stylesheet" type="text/css" />
    <link href="/clojure-backtesting-website/css/reset.css" rel="stylesheet" type="text/css" />
    <link href="/clojure-backtesting-website/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/clojure-backtesting-website/css/typography.css" rel="stylesheet" type="text/css" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/tomorrow-night-eighties.min.css">
    <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>

<div id="left">

    <p id="logo">
        <a title="Clojure Backtesting Documentation" href="/clojure-backtesting-website/">
            <span class="fa fa-code"></span>
            <span class="text">Clojure Backtesting</span>
        </a>
    </p>

    <div id="menucont" class="bodycontainer clearfix">
        <div class="menutitle">
            <p><span class="fa fa-reorder"></span><strong>Menu</strong></p>
        </div>
        <ul class="menu">
            <li><a title="Home" href="/clojure-backtesting-website/">Home</a></li>
            <li><a href="/clojure-backtesting-website/posts/get-started/">Get Started</a></li>
            <li><a href="/clojure-backtesting-website/posts/user-guide/">User Guide</a></li>
            <li><a href="/clojure-backtesting-website/posts/api/">Basic APIs</a></li>
            <li><a href="/clojure-backtesting-website/posts/portfolio">Porfolio Mangement</a></li>
            <li><a href="/clojure-backtesting-website/posts/evaluate">Evaluation</a></li>
            <li><a href="/clojure-backtesting-website/posts/indicators">Indicators</a></li>
            <li><a href="/clojure-backtesting-website/posts/parameters">Parameters</a></li>
            <li><a href="/clojure-backtesting-website/posts/examples">Examples</a></li>
        </ul>
    </div>

    <div id="socialmedia" class="clearfix">
        <ul>
            <li>
                <a title="GitHub" href="https://github.com/clojure-finance/clojure-backtesting" rel="external">
                    <span class="fa fa-github"> 
                        <span style="font-family: 'Montserrat';text-transform: uppercase;">&nbsp;Github</span>
                    </span>
                </a>
            </li>
            <!-- <li><a title="Stack Overflow" href="./" rel="external"><span class="fa fa-stack-overflow"></span></a></li>
            <li><a title="Google+" href="./" rel="external"><span class="fa fa-google-plus"></span></a></li>
            <li><a title="LinkedIn" href="./" rel="external"><span class="fa fa-linkedin"></span></a></li>
            <li><a title="Last.fm" href="./" rel="external"><span class="fa fa-lastfm"></span></a></li> -->
        </ul>
    </div>

</div>

<div id="right" class="clearfix">
    
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <!-- <strong>2021年1月20日</strong> -->
        
    </div>
    <h1>User Guide</h1>
</div>
<div>
    <ol class="toc"><li><a href="#about-the-dataset">About the dataset</a></li><ol><li><a href="#essential-column-names">Essential Column Names</a></li><ol><li><a href="#crsp-dataset">CRSP dataset</a></li></ol></ol><li><a href="#trading-logic">Trading Logic</a></li><li><a href="#cache-mechanism">Cache Mechanism</a></li></ol>
    <h2 id="about-the-dataset">About the dataset</h2><p><strong><a href="https://connecthkuhk-my.sharepoint.com/:u:/g/personal/u35lyc_connect_hku_hk/ESQNElD-vL1KliKmOf57D2ABLCLYLHoc9wkJWhXUSTzCNw?e=DNaVWm">CRSP</a></strong> is the official dataset for the backtester. New users are recommended to directly use this dataset to try out the functionalities of the backtester. Definitions for each column in CRSP can be found <a href="/clojure-backtesting-website/posts/docs/data_descriptions_guide_0.pdf">here</a>.</p><p>Of course, you can use your own dataset in the backtester. Follow this <a href="">guide</a> on how to reform arbitrary dataset to be compatible with the backtester.</p><p>To load the CRSP dataset, simply run</p><pre><code class="clojure">(load-dataset "/Volumes/T7/CRSP" "main" add-aprc) ;; change the first argument to your local path
(load-dataset "/Volumes/T7/Compustat/" "compustat")
</code></pre><br /><p><strong><a href="https://connecthkuhk-my.sharepoint.com/:u:/g/personal/u35lyc_connect_hku_hk/EbHsTj2Nrx5Or8PP_GkiCeIBlcrijdG_Bm6JElMaHTTFFA?e=fdECXp">Compustat</a></strong> is a quarterly supplementary file of CRSP. It contains company related information that can be used for further analysis. Definitions for each column in Compustat can be found <a href="/clojure-backtesting-website/posts/docs/FundamentalsAnnual.pdf">here</a>.</p><p>To load the Compustat dataset, simply run</p><pre><code class="clojure">(load-dataset "/Volumes/T7/Compustat/" "compustat") ;; change the first argument to your local path
</code></pre><p>The Compustat dataset will not overwrite the CRSP dataset. Instead, the rows of Compustat will be automatically merged with the corresponding CRSP rows. You can still use functions such as <code>get-info</code>, <code>get-info-map</code>, <code>get-tic-info</code> as normal, except that some (not all) rows may be longer, because of Compustat.</p><p>Both datasets are available <a href="https://connecthkuhk-my.sharepoint.com/:f:/g/personal/u35lyc_connect_hku_hk/EuAAauw1fuNFoDRav2D0J_EB6T_bbfkyNZ5ShN8Xw0cqhw?e=RtOcFL">here</a>.</p><h3 id="essential-column-names">Essential Column Names</h3><h5 id="crsp-dataset">CRSP dataset</h5><ul><li><p><code>:PRC</code> : closing price</p></li><li><p><code>:OPENPRC</code> : opening price</p></li><li><p><code>:DATE</code> : date (yyyy-MM-dd)</p></li><li><p><code>:PERMNO</code> : security identifier</p><p><strong>This documentation will use <em>permno</em> and <em>security</em> interchangeably.</strong></p></li><li><p><code>:APRC</code> : adjusted close price</p></li></ul><p><strong>Remark:</strong></p><ul><li>The trading price is by default set to be <strong>closing price</strong>.</li></ul><h2 id="trading-logic">Trading Logic</h2><p>As introduced in the <a href="/clojure-backtesting-website/posts/api#move-time-pointer">time pointer</a>, there is a global clock in the backtester. Your strategy will normally be run between two <code>next-date</code>s. Below is a figure illustrating the logic of trading with an example.</p><p><img src="/clojure-backtesting-website/img/trade-logic.jpg" alt="image" /></p><p>Say you are on date 2022-10-24, and you buy 10 shares of xx security. This order will not be traded immediately. Instead, it will result in a pending order which will be settle by the backtester on the next call of <code>next-date</code> (if there is indeed xx security in the market). What you will observe is that your portfolio will not change immediately after <code>order</code>, and <code>order-record</code> will not be updated either. They will only be updated on the next day. The price of the traded ticker is by default the <strong>closing price</strong> of the next day. The consequence of the settling the pending orders is always the change of cash (loan) and stock (cash ↑ stock ↓ or cash ↓ stock ↑ ). Loans will result in interest costs which will accumulate every day the loan exists.</p><h2 id="cache-mechanism">Cache Mechanism</h2><p>Since the backtester uses dataset that stores on disk memory and needs to access it frequently. To avoid repetitive File IO, the backtester uses a cache system to remember the market information of days that you have inspected before. By default, the cache can store 30 days of information, and you can change it depending on the memory size of your computer. For example, we recommend 30 for a 8-GB computer and 60 for a 16-GB one.</p><pre><code class="clojure">(CHANGE-CACHE-SIZE 60) ;; increase the cache size to 60
</code></pre><p>When cache exceeds its size limit, the backtester will remove the oldest information. The time here is determined by the date of the information rather than the adding date. If the data requested is not in cache, the backtester will fetch it from the file which will creates a delay. Therefore, we recommend you to refer back historical data within the range of the cache, which is 30. Older retrospect may take significantly longer time.</p>
</div>

<br/>

    <div id="prev-next">
        <!-- 
        <a class="button" href="/clojure-backtesting-website/posts/examples/">&laquo; Examples</a>
        
        
        <a class="right button" href="/clojure-backtesting-website/posts/evaluate/">Evaluatation &raquo;</a>
         -->
    </div>

    


</div>

<hr/>
<div id="footercont" class="clearfix">Copyright &copy; 2022 clojure-backtesting
    <span id="footerack">
        <!-- <p>Powered by <a href="http://cryogenweb.org">Cryogen</a> | Free Website Template by <a title="free website templates" href="http://www.downloadwebsitetemplates.co.uk" rel="external">Download Website Templates</a></p> -->
        <p>Powered by <a href="http://cryogenweb.org">Cryogen</a></p>
    </span>
</div>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="/clojure-backtesting-website/js/highlight.pack.js" type="application/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/clojure-backtesting-website/js/scripts.js" type="application/javascript"></script>


</body>
</html>
