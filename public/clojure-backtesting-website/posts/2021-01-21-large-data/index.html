<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Clojure Backtesting Documentation: Large Data</title>
    
<meta name="keywords" content="">

<meta name="description" content="ns: large-data">

<meta property="og:description" content="ns: large-data">

<meta property="og:url" content="https://clojure-finance.github.io/clojure-backtesting-website/clojure-backtesting-website/posts/2021-01-21-large-data/" />
<meta property="og:title" content="Large Data" />
<meta property="og:type" content="article" />

    <link rel="canonical" href="https://clojure-finance.github.io/clojure-backtesting-website/clojure-backtesting-website/posts/2021-01-21-large-data/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/clojure-backtesting-website/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/clojure-backtesting-website/">Clojure Backtesting Documentation</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/clojure-backtesting-website/">Home</a></li>
                <li
                ><a href="/clojure-backtesting-website/archives/">Archives</a></li>
                
                <li
                >
                <a href="/clojure-backtesting-website/pages/about/">About</a>
                </li>
                
                <!-- <li><a href="/clojure-backtesting-website/feed.xml">RSS</a></li> -->
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-9">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">21 January 2021</div>
        
    </div>
    <h2>Large Data</h2>
</div>
<div>
    <ol class="toc"><li><a href="#read-in-to-do">Read in (to do)</a></li><li><a href="#make-order-to-do">Make Order (to do)</a></li><li><a href="#get-corresponding-line">Get Corresponding line</a></li></ol>
    <br /><p><code>ns: large-data</code></p><p>This namespace features functions to handle large datasets that cannot be loaded to memory at one time, e.g. data-CRSP.csv.</p><hr /><h3 id="read-in-to-do">Read in (to do)</h3><p>Lazily read in the large datasets, with unique name and function.</p><br /><p><code>init-portfolio</code></p><p><strong>Parameters:</strong></p><ul><li><code>date</code> - starting date: <strong>Must be a valid date in the dataset</strong></li><li><code>cash</code> - the amount of money you have initially</li></ul><p><em>Optional parameters:</em></p><ul><li><code>:standard</code>: boolean: set to false if you are not using a standard dataset. By default, true.</li></ul><p><strong>Possible usages:</strong></p><pre><code class="clojure">(init-portfolio "1980-12-15" 100000)
;; means that you start at "1980-12-15" havin 100000 cash
</code></pre><h3 id="make-order-to-do">Make Order (to do)</h3><p>Functions for making an order to trade a stock.</p><br /><p><code>order-lazy</code></p><p>This order function allows user to set orders for large dataset.</p><p><strong>Parameters:</strong></p><ul><li><code>tic</code> - name / identifier of the ticker to buy or sell (string)</li><li><code>quantity</code> - the quantity to trade. If it is positive, buy the amount, else if it negative, sell the amount. (int/double)</li></ul><p><em>Optional parameters:</em></p><ul><li><p><code>:remaining</code> -  boolean: if the quantity given is the trading amount or the exact remaining amount. <em>By default, false.</em> It is true, meaning that after this order, I want to have <code>quantity</code> amount of certain tickers on my account.</p></li><li><p><code>:leverage</code> - boolean: if leverage is <strong>allowed</strong> (if necessary) in this order. Leverage includes buying on margin and short sell. You will only buy on margin if you run out of cash. We will also short sell only when you do not have enough stock. <em>By default, true.</em></p></li><li><p><code>:dataset</code> -  lazy sequence: Specify the dataset to look for the order. Note that the function will search from the first line of the given dataset. So if used properly, it could speed up the program. If you are using a standard format dataset, you do not need to use this argument.</p></li><li><p><code>:print</code>  - boolean: If to print the successful orders. By default, false.</p></li><li><p><code>:direct</code> - boolean: If to direct the order record into a outer file. By default, true. You will find the file named <strong>out-order-record.csv</strong> in the same directory of your running program, i.e. if you create another clj file, it will be under the same layer of your clj file.</p><p><strong>The only difference with ordinary <code>order</code>:</strong></p></li><li><p><code>:expiration</code> -  int: how many days will this order request be effective. For example, if input 1, then this order request will be withdrawn after tomorrow (if this order does not trade that day because of no such ticker).</p></li></ul><br /><p><strong>Possible usages:</strong></p><ol><li><p><em>Order with or without leverage:</em></p><pre><code class="clojure">(order "AAPL" 10) ;with leverage, exact value trading
(order "AAPL" 10 :leverage false) ;without leverage, exact value trade
(order "AAPL" -10 :remaining true) ;with leverage, remaining value
(order "AAPL" -10 :leverage false :remaining true) ;without leverage, remaining value (This must be a failed trade)
</code></pre></li><li><p><em>Use together with the available-tics: (This will buy 10 stocks from the first ticker that shows in available-tics.)</em></p><pre><code class="clojure">(let [tics (deref available-tics) tic (name (first (keys (tics))))]
   (order tic 10 :dataset (get (deref (get (get (dref available-tics) :AAPL) :pointer)) :reference))) ; The part after the dataset is copied from usages of available-tics (but you do not need to do this in real life, it is already built into the function).
</code></pre></li><li><p><em>Print the order log:</em></p><pre><code class="clojure">(order "AAPL" 10 :print true)
</code></pre><p>â€‹</p></li></ol><hr /><h3 id="get-corresponding-line">Get Corresponding line</h3><br /><p><code>get-compustat-line</code></p><p>This function reach out to compustat to find the corresponding line for CRSP.</p><p><strong>Parameters:</strong></p><ul><li><code>line</code> - map: a line of CRSP dataset (with valid date).</li><li><code>name</code> - the name of compustat dataset</li></ul><p><strong>Example:</strong></p><pre><code class="clojure">(get-compustat-line (get (get (deref available-tics) "IBM") :reference) "compustat")

;; output
{:fincfq "", :dpcy "", :fic "USA", :itccy "", :cshoq "", :dltisq "", :wcapchq "", :niq "59.213", :dpcq "", :sstkq "", :cik "51143.0", :oancfq "", :loq "", :pstkrq "", :oibdpq "", :ipodate "", :datafqtr "1962.5", :prstkcq "", :ivncfy "", :pstkq "", :saleq "467.7", :ltq "", :lctq "", :txdbq "", :dlcq "", :ppentq "", :dpq "", :atq "", :dvpq "", :wcapchy "", :capxy "", :itccq "", :xintq "", :datacqtr "1962.5", :dltrq "", :ibq "59.213", :actq "", :mibtq "", :xrdq "", :sstky "", :invtq "", :dvy "", :oiadpq "", :mibq "", :icaptq "", :txditcq "", :prccq "353.1442", :ceqq "", :sppey "", :dvq "", :seqq "", :fincfy "", :capxq "", :revtq "467.7", :oancfy "", :ivncfq "", :cusip "459200101", :dltisy "", :gvkey "6066", :addzip "10504", :dlttq "", :prstkcy "", :rdq "", :sic "7370.0", :xsgaq "", :exchg "11.0", :dltry "", :rectq "", :sppeq "", :cogsq "", :tic "IBM", :cheq "", :datadate "1962-09-30", :conm "INTL BUSINESS MACHINES CORP"}
</code></pre>
</div>


    <div id="prev-next">
        
        <a href="/clojure-backtesting-website/posts/2021-01-22-portfolio/">&laquo; Portfolio</a>
        
        
        <a class="right" href="/clojure-backtesting-website/posts/2020-12-31-example-golden-cross/">Example - Golden Cross &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>

        <div class="col-md-3">
            <div id="sidebar">
                <h3>Links</h3>
                <ul id="links">
                    <li><a href="https://github.com/clojure-finance/clojure-backtesting">Github Repository</a></li>
                    <!-- <li><a href="http://cryogenweb.org/docs/home.html">Cryogen Docs</a></li>
                    <li><a href="https://carmen.la/blog/archives/">Carmen's Blog</a></li> -->
                    
                </ul>
                
                <div id="recent">
                    <h3>Recent Posts</h3>
                    <ul>
                        
                        <li><a href="/clojure-backtesting-website/posts/2021-01-27-get-started/">Get Started</a></li>
                        
                        <li><a href="/clojure-backtesting-website/posts/2021-01-26-preliminaries/">Preliminaries</a></li>
                        
                        <li><a href="/clojure-backtesting-website/posts/2021-01-25-data-management/">Data Management</a></li>
                        
                    </ul>
                </div>
                
                
            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2021 clojure-backtesting
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/clojure-backtesting-website/js/highlight.pack.js" type="text/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>
